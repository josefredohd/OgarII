const _0xf66114=_0xd135;(function(_0x112c28,_0x172aa8){const _0x45949f=_0xd135,_0x3ba8ea=_0x112c28();while(!![]){try{const _0x22a2d2=parseInt(_0x45949f(0x1e2))/0x1*(-parseInt(_0x45949f(0x1ad))/0x2)+-parseInt(_0x45949f(0x19e))/0x3+-parseInt(_0x45949f(0x1c3))/0x4*(parseInt(_0x45949f(0x1dd))/0x5)+-parseInt(_0x45949f(0x1ab))/0x6+-parseInt(_0x45949f(0x1bd))/0x7+parseInt(_0x45949f(0x1c8))/0x8*(-parseInt(_0x45949f(0x1d2))/0x9)+parseInt(_0x45949f(0x1b8))/0xa;if(_0x22a2d2===_0x172aa8)break;else _0x3ba8ea['push'](_0x3ba8ea['shift']());}catch(_0x4ba039){_0x3ba8ea['push'](_0x3ba8ea['shift']());}}}(_0x3390,0xa8182));const Router=require(_0xf66114(0x1da)),Reader=require(_0xf66114(0x1bc)),{filterIPAddress}=require('../primitives/Misc');class Connection extends Router{constructor(_0x526d89,_0xeb6969){const _0x5d197a=_0xf66114;super(_0x526d89),this[_0x5d197a(0x1b3)]=filterIPAddress(_0xeb6969[_0x5d197a(0x193)][_0x5d197a(0x1b3)]),this[_0x5d197a(0x198)]=_0xeb6969,this['connectTime']=Date[_0x5d197a(0x1df)](),this[_0x5d197a(0x1ce)]=Date[_0x5d197a(0x1df)](),this['passwordVerified']=![],this['lastChatTime']=Date[_0x5d197a(0x1df)](),this['upgradeLevel']=0x0,this['protocol']=null,this[_0x5d197a(0x185)]=![],this['closeCode']=NaN,this[_0x5d197a(0x189)]=null,this[_0x5d197a(0x1cd)]=[],this[_0x5d197a(0x1e5)]=![],this['controllingMinions']=![],_0xeb6969['on'](_0x5d197a(0x1ba),this[_0x5d197a(0x1d6)]['bind'](this)),_0xeb6969['on'](_0x5d197a(0x1a6),this[_0x5d197a(0x1b1)][_0x5d197a(0x1b6)](this)),_0xeb6969['on']('ping',this[_0x5d197a(0x197)][_0x5d197a(0x1b6)](this,0x3eb,_0x5d197a(0x199))),_0xeb6969['on']('pong',this[_0x5d197a(0x197)][_0x5d197a(0x1b6)](this,0x3eb,'Unexpected\x20message\x20format'));}[_0xf66114(0x1ba)](){const _0x18ca45=_0xf66114;if(!this[_0x18ca45(0x185)])return void this['closeSocket'](0x3e9,_0x18ca45(0x1a8));super[_0x18ca45(0x1ba)](),this[_0x18ca45(0x192)]=!![],this[_0x18ca45(0x1af)]=this['handle'][_0x18ca45(0x182)],this[_0x18ca45(0x1e0)][_0x18ca45(0x1a9)](this,this[_0x18ca45(0x1de)],this[_0x18ca45(0x189)]),this['webSocket']['removeAllListeners']();}static get[_0xf66114(0x1ca)](){return'connection';}static get[_0xf66114(0x1e3)](){return!![];}static get['separateInTeams'](){return!![];}['onSocketClose'](_0x2e33d0,_0x41f3f6){const _0x4cb921=_0xf66114;if(this['socketDisconnected'])return;this[_0x4cb921(0x1d5)][_0x4cb921(0x1a2)]('connection\x20from\x20'+this[_0x4cb921(0x1b3)]+_0x4cb921(0x1ae)),this[_0x4cb921(0x185)]=!![],this[_0x4cb921(0x1de)]=_0x2e33d0,this[_0x4cb921(0x189)]=_0x41f3f6;}[_0xf66114(0x1b1)](_0x564809){const _0x3621ed=_0xf66114,_0x4ec296=new Reader(Buffer[_0x3621ed(0x1b2)](_0x564809),0x0);if(!this['passwordVerified']){const _0x2eb514=_0x4ec296['readZTStringUTF8']();if(_0x2eb514===_0x3621ed(0x1e8)){this[_0x3621ed(0x1cb)]=!![];return;}else{this['closeSocket'](0xfa1,_0x3621ed(0x1b4));return;}}this[_0x3621ed(0x1cc)]!==null?this[_0x3621ed(0x1cc)][_0x3621ed(0x1b1)](_0x4ec296):(this[_0x3621ed(0x1cc)]=this[_0x3621ed(0x186)][_0x3621ed(0x1a4)][_0x3621ed(0x1b7)](this,_0x4ec296),this[_0x3621ed(0x1cc)]===null&&this[_0x3621ed(0x197)](0x3eb,_0x3621ed(0x188)));}[_0xf66114(0x1b0)](){const _0x3f68dc=_0xf66114;super[_0x3f68dc(0x1b0)]();if(this['settings']['chatEnabled'])this[_0x3f68dc(0x1e0)][_0x3f68dc(0x187)][_0x3f68dc(0x18f)](this);if(this['settings'][_0x3f68dc(0x19b)])this['listener'][_0x3f68dc(0x187)][_0x3f68dc(0x1a1)](null,this,_0x3f68dc(0x18a)),this[_0x3f68dc(0x1e0)][_0x3f68dc(0x187)][_0x3f68dc(0x1a1)](null,this,_0x3f68dc(0x196));else this[_0x3f68dc(0x186)][_0x3f68dc(0x1e7)][_0x3f68dc(0x195)](this);}[_0xf66114(0x1bb)](_0x25cf5f){const _0x2a01ba=_0xf66114;_0x25cf5f=_0x25cf5f[_0x2a01ba(0x19c)]();if(!_0x25cf5f)return;const _0x3fc7a3=this[_0x2a01ba(0x1e0)]['globalChat'],_0x2ab070=this[_0x2a01ba(0x1d9)];this[_0x2a01ba(0x1d9)]=Date[_0x2a01ba(0x1df)]();if(_0x25cf5f['length']>=0x2&&_0x25cf5f[0x0]==='/'){if(!this[_0x2a01ba(0x186)][_0x2a01ba(0x1b5)]['execute'](this,_0x25cf5f[_0x2a01ba(0x183)](0x1)))_0x3fc7a3['directMessage'](null,this,_0x2a01ba(0x18d));}else{if(Date[_0x2a01ba(0x1df)]()-_0x2ab070>=this[_0x2a01ba(0x1e6)][_0x2a01ba(0x1d4)])_0x3fc7a3['broadcast'](this,_0x25cf5f);}}[_0xf66114(0x1c9)](){const _0x37e8e1=_0xf66114;if(!this[_0x37e8e1(0x1d7)])return;if(this[_0x37e8e1(0x1e0)][_0x37e8e1(0x1e6)][_0x37e8e1(0x1db)]&&this[_0x37e8e1(0x1cd)][_0x37e8e1(0x1d3)]>0x0)this[_0x37e8e1(0x19a)]=!this[_0x37e8e1(0x19a)];else this[_0x37e8e1(0x186)][_0x37e8e1(0x1b9)][_0x37e8e1(0x184)](this['player']);}get[_0xf66114(0x1d1)](){const _0x4169be=_0xf66114;return this[_0x4169be(0x185)];}['update'](){const _0x42e81c=_0xf66114;if(!this[_0x42e81c(0x1d7)])return;if(!this['player'][_0x42e81c(0x1c0)]){if(this[_0x42e81c(0x1c7)]!==null)this[_0x42e81c(0x186)][_0x42e81c(0x1e7)][_0x42e81c(0x195)](this);this[_0x42e81c(0x1c7)]=null,this[_0x42e81c(0x1ac)]=0x0,this[_0x42e81c(0x1a7)]=0x0,this[_0x42e81c(0x1c6)]=![],this[_0x42e81c(0x1c4)]=![],this[_0x42e81c(0x1aa)]=![];return;}this[_0x42e81c(0x18e)][_0x42e81c(0x1c1)]();const _0x1422eb=[],_0x4241aa=[],_0x21ac51=[],_0x518294=[],_0x1b9810=this[_0x42e81c(0x18e)],_0x2e9f89=_0x1b9810[_0x42e81c(0x1a3)],_0x44eb45=_0x1b9810[_0x42e81c(0x19f)];for(let _0x3fe15d in _0x2e9f89){const _0x2f12d6=_0x2e9f89[_0x3fe15d];if(!_0x44eb45[_0x42e81c(0x19d)](_0x3fe15d))_0x1422eb[_0x42e81c(0x1d0)](_0x2f12d6);else{if(_0x2f12d6[_0x42e81c(0x190)])_0x4241aa['push'](_0x2f12d6);}}for(let _0x468c82 in _0x44eb45){const _0x374938=_0x44eb45[_0x468c82];if(_0x2e9f89[_0x42e81c(0x19d)](_0x468c82))continue;if(_0x374938[_0x42e81c(0x1a0)]!==null)_0x21ac51[_0x42e81c(0x1d0)](_0x374938);_0x518294[_0x42e81c(0x1d0)](_0x374938);}if(_0x1b9810['state']===0x1||_0x1b9810[_0x42e81c(0x1dc)]===0x2)this[_0x42e81c(0x1cc)][_0x42e81c(0x18c)](_0x1b9810[_0x42e81c(0x194)]);if(this[_0x42e81c(0x186)][_0x42e81c(0x182)]%0x4===0x0)this[_0x42e81c(0x186)][_0x42e81c(0x1b9)][_0x42e81c(0x181)](this);this[_0x42e81c(0x1cc)][_0x42e81c(0x1bf)](_0x1422eb,_0x4241aa,_0x21ac51,_0x518294);}[_0xf66114(0x191)](){const _0x2b5c52=_0xf66114;this[_0x2b5c52(0x1cc)][_0x2b5c52(0x1cf)](this['player'][_0x2b5c52(0x1e1)][_0x2b5c52(0x1a5)],!![],this[_0x2b5c52(0x1cc)]);}[_0xf66114(0x1d8)](_0x2e3465){const _0x29d03a=_0xf66114;this[_0x29d03a(0x1cc)][_0x29d03a(0x1d8)](_0x2e3465);}[_0xf66114(0x1c5)](){const _0x3d20fc=_0xf66114;this['protocol'][_0x3d20fc(0x1c5)]();}[_0xf66114(0x1c2)](_0xd610ee){const _0x9a4a65=_0xf66114;if(this[_0x9a4a65(0x185)])return;this['webSocket'][_0x9a4a65(0x1c2)](_0xd610ee);}[_0xf66114(0x197)](_0x1cb834,_0x56cee9){const _0x2a2fb5=_0xf66114;if(this[_0x2a2fb5(0x185)])return;this['socketDisconnected']=!![],this[_0x2a2fb5(0x1de)]=_0x1cb834,this['closeReason']=_0x56cee9,this[_0x2a2fb5(0x198)][_0x2a2fb5(0x1ba)](_0x1cb834||0x3ee,_0x56cee9||'');}}module[_0xf66114(0x1be)]=Connection;function _0xd135(_0x3b88ce,_0x559bb0){const _0x33902b=_0x3390();return _0xd135=function(_0xd135b3,_0x483ca8){_0xd135b3=_0xd135b3-0x181;let _0x3d52cc=_0x33902b[_0xd135b3];return _0x3d52cc;},_0xd135(_0x3b88ce,_0x559bb0);}function _0x3390(){const _0x1e1e0c=['socketDisconnected','handle','globalChat','Ambiguous\x20protocol','closeReason','This\x20server\x20requires\x20players\x20to\x20be\x20queued.','./Listener','onSpectatePosition','unknown\x20command,\x20execute\x20/help\x20for\x20the\x20list\x20of\x20commands','player','add','shouldUpdate','onWorldSet','disconnected','_socket','viewArea','toggleQueued','Try\x20spawning\x20to\x20enqueue.','closeSocket','webSocket','Unexpected\x20message\x20format','controllingMinions','matchmakerNeedsQueuing','trim','hasOwnProperty','4108374tvNVVO','lastVisibleCells','eatenBy','directMessage','debug','visibleCells','protocols','border','message','ejectAttempts','Manual\x20connection\x20close\x20call','onDisconnection','hasProcessedQ','596232qaikpk','splitAttempts','14WzDlZD','\x20has\x20disconnected','disconnectionTick','createPlayer','onSocketMessage','from','remoteAddress','Incorrect\x20password','chatCommands','bind','decide','40523060gfWCoI','gamemode','close','onChatMessage','../primitives/Reader','6422752yZTpjb','exports','onVisibleCellUpdate','hasWorld','updateVisibleCells','send','4anKyPg','isPressingQ','onWorldReset','requestingSpectate','spawningName','1328UXDmiO','onQPress','type','passwordVerified','protocol','minions','lastActivityTime','onNewWorldBounds','push','shouldClose','7785ooEEUE','length','chatCooldown','logger','onSocketClose','hasPlayer','onNewOwnedCell','lastChatTime','./Router','minionEnableQBasedControl','state','3057755jaWWUA','closeCode','now','listener','world','31755ZvdEyT','isExternal','../bots/Minion','minionsFrozen','settings','matchmaker','fredo123','sendLeaderboard','tick','slice','whenPlayerPressQ'];_0x3390=function(){return _0x1e1e0c;};return _0x3390();}const WebSocket=require('ws'),Listener=require(_0xf66114(0x18b)),Minion=require(_0xf66114(0x1e4)),Protocol=require('../protocols/Protocol');